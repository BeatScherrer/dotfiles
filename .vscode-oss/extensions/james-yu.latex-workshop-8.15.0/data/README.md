
# Data files for intellisense

We describe how the data files used for intellisense, namely `.json` files, are generated

## Unicode mathematical symbols

The file `unimathsymbols.json` is generated from the [`unimathsymbols.txt`](http://milde.users.sourceforge.net/LUCR/Math/data/unimathsymbols.txt) by GÃ¼nter Milde using the [`unimathsymbols.py`](../dev/unimathsymbols.py) script.

## Default commands and environments

Default lists of commands and environments are defined in

- [`commands.json`](commands.json)
- [`environments.json`](environments.json)

## Bibtex

The file [`../data/commands.json`] defines the list of automatically inserted fields.

## Files inside `packages/`

JSON files in this directory and in the subdirectories are generated
from [cwl files by the LaTeXing project](https://github.com/LaTeXing/LaTeX-cwl)

The `.cwl` files provided the LaTeXing project describe for every LaTeX package or class the commands and the environments it defines. We process this information using the [`pkgcommand.py`](../dev/pkgcommand.py) script. For every package/class, it writes two files

- A `_cmd.json` file listing all the commands defined by the package/class in the form

    ```json
    "acro{}{}": {
        "command": "acro{acronym}{full name}",
        "package": "acronym",
        "snippet": "acro{${1:acronym}}{${2:full name}}"
    }
    ```

    The arguments (including the optional ones) are part of the command name to allow for several variants of the same command.

- A `_env.json` file listing all the environments defined by the package/class in the form

    ```json
    "aligned": {
        "name": "aligned",
        "detail": "aligned",
        "snippet": "",
        "package": "amsmath"
    }
    ```

    If the environment takes extra arguments, they are listed in the `snippet` field

    ```json
    "aligned []": {
        "name": "aligned",
        "detail": "aligned[alignment]",
        "snippet": "[${1:alignment}]",
        "package": "amsmath"
   }

    "alignat* []{}": {
        "name": "alignat*",
        "detail": "alignat*[alignment]{n}",
        "snippet": "[${2:alignment}]{${1:n}}",
        "package": "amsmath"
    }
   ```

Completion files for classes are all prefixed by `class-`.

## Class names

Class names are stored in [`classnames.json`](classnames.json)

This file is generated by the [`ctanpkglist.py`](../dev/ctanpkglist.py) script: it searches for all the `.cls` files list in the `ls-R` database of the local LaTeX installation.

**Note that this file depends on the local LaTeX installation**

## Class and package names

Package names are stored in [`packagenames.json`](packagenames.json)

This file is based on the list provided by [CTAN](https://ctan.org/json/2.0/packages) and on the [`ctanpkglist.py`](../dev/ctanpkglist.py) script. Getting a proper list is a bit tricky as the package name (as listing by CTAN) does not always match the base name of the `.sty` file to be loaded by `\usepackage`. The tricky part is more or less handled by the Python script in the following way

- We use the local `ls-R` file to
  - List all the `.sty` files provided by the local LaTeX installation.
  - For every directory in `texmf`, list the `.sty` files it contains. The last component of a directory name inside `texmf` is typically the package name as defined by CTAN, hence the name to pass to `\usepackage` is the base name of one of the `.sty` files inside it.
- For every package `pkg` listed by CTAN
  - If `pkg.sty` exists on the local installation, store `pkg` for package intellisense.
  - If not, search if a directory `pkg/` exists and look up a file whose lowercase name matches `pkg`. If it is found, then save it for package intellisense.

As some packages cannot be properly detected using the above mechanism, we maintain a list of extra packages to be added to the list in [extra-packagenames.json](../dev/extra-packagenames.json). These packages are automatically added at the end of [`ctanpkglist.py`](../dev/ctanpkglist.py) script.

## Misc

We have to use four backslashes `\\\\` in some snippet definitions. See  the [official document](https://code.visualstudio.com/docs/editor/userdefinedsnippets#_grammar), [microsoft/vscode/issues/32020](https://github.com/microsoft/vscode/issues/32020), and [microsoft/vscode/issues/33933](https://github.com/microsoft/vscode/issues/33933) for the details.
